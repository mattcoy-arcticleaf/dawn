{% comment %}
    Render Product complementary
    Accepts:
    - section_id: {String} ID of the section that includes this snippet
    - block_id: {String} ID of the block within the section
    - product_id: {String} ID of the main product
    - product_list_limit: {Number} Maximum number of complementary products to show
    - block_heading: {String} Heading text for the complementary section
    - products_per_page: {Number} Number of products to show per page (used for pagination)
    - pagination_style: {String} Style or layout for paginating products (e.g., 'number', 'counter')
    Usage:
    {% render 'product-complementary', 
        section_id: section.id, 
        block_id: block.id, 
        product_id: product.id, 
        product_list_limit: block.settings.product_list_limit
        block_heading: block.settings.block_heading
        products_per_page: block.settings.products_per_page
        pagination_style: block.settings.pagination_style
    %}
{% endcomment %}

<product-recommendations  
    class="complementary-products quick-add-hidden
    {% if block.settings.make_collapsible_row %} 
        is-accordion
    {% endif %}
    {% if block.settings.enable_quick_add %} 
        complementary-products-contains-quick-add
    {% endif %}"
    data-url="{{ routes.product_recommendations_url }}?limit={{ product_list_limit }}&intent=complementary"  
    data-section-id="{{ section_id }}"  
    data-product-id="{{ product_id }}"
>
    {%- if recommendations.performed and recommendations.products_count > 0 -%}
        <aside
            aria-label="{{ 'accessibility.complementary_products' | t }}"
            {{ block.shopify_attributes -}}
            {% if block.settings.make_collapsible_row %}
            class="product__accordion accordion"
            {% endif %}
        >
            <div class="complementary-products__container">
                {%- if block.settings.make_collapsible_row -%}
                    <details id="Details-{{ block_id }}-{{ section_id }}" open>
                        <summary>
                {%- endif %}
                        <div class="summary__title">
                            {%- if block.settings.make_collapsible_row -%}
                                {% render 'icon-accordion', icon: block.settings.icon %}
                                <h2 class="h4 accordion__title">{{ block_heading }}</h2>
                            {%- else -%}
                                <h2 class="h3 accordion__title">{{ block_heading }}</h2>
                            {%- endif -%}
                        </div>
                    {%- if block.settings.make_collapsible_row -%}
                        {{- 'icon-caret.svg' | inline_asset_content -}}
                        </summary>
                    {%- endif -%}
                    <slideshow-component class="slider-mobile-gutter">
                        {%- assign number_of_slides = recommendations.products_count
                            | plus: 0.0
                            | divided_by: products_per_page
                            | ceil
                        -%}
                        <div
                            id="Slider-{{ block_id }}"
                            class="contains-card contains-card--product complementary-slider grid grid--1-col slider slider--everywhere"
                            role="list"
                            {% if number_of_slides > 1 %}
                                aria-label="{{ 'general.slider.name' | t }}"
                            {% endif %}
                        >
                            {% assign skip_card_product_styles = false %}
                            {%- for i in (1..number_of_slides) -%}
                                <div
                                    id="Slide-{{ block_id }}-{{ forloop.index }}"
                                    class="complementary-slide complementary-slide--{{ settings.card_style }} grid__item slider__slide slideshow__slide"
                                    tabindex="-1"
                                    role="group"
                                    {% if number_of_slides > 1 %}
                                        aria-roledescription="{{ 'sections.slideshow.slide' | t }}"
                                        aria-label="{{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}"
                                    {% endif %}
                                >
                                    <ul class="list-unstyled" role="list">
                                        {%- for product in recommendations.products
                                            limit: products_per_page
                                            offset: continue
                                        -%}
                                            <li>
                                                {%- if block.settings.enable_quick_add -%}
                                                {% assign quick_add = 'standard' %}
                                                {%- else -%}
                                                {% assign quick_add = 'none' %}
                                                {%- endif -%}
                                                {% render 'card-product',
                                                card_product: product,
                                                media_aspect_ratio: block.settings.image_ratio,
                                                show_secondary_image: false,
                                                lazy_load: false,
                                                skip_styles: skip_card_product_styles,
                                                quick_add: quick_add,
                                                section_id: section_id,
                                                horizontal_class: true,
                                                horizontal_quick_add: true
                                                %}
                                            </li>
                                            {%- assign skip_card_product_styles = true -%}
                                        {%- endfor -%}
                                    </ul>
                                </div>
                            {%- endfor -%}
                        </div>
                        {%- if number_of_slides > 1 -%}
                            <div class="slider-buttons">
                                <button
                                    type="button"
                                    class="slider-button slider-button--prev"
                                    name="previous"
                                    aria-label="{{ 'general.slider.previous_slide' | t }}"
                                >
                                    <span class="svg-wrapper">
                                        {{- 'icon-caret.svg' | inline_asset_content -}}
                                    </span>
                                </button>
                                <div 
                                    class="slider-counter slider-counter--{{ pagination_style }}{% if pagination_style == 'counter' 
                                        or pagination_style == 'numbers' %} 
                                        caption
                                    {% endif %}"
                                >
                                    {%- if pagination_style == 'counter' -%}
                                        <span class="slider-counter--current">1</span>
                                        <span aria-hidden="true"> / </span>
                                        <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
                                        <span class="slider-counter--total">{{ number_of_slides }}</span>
                                    {%- else -%}
                                        <div class="slideshow__control-wrapper">
                                            {%- for i in (1..number_of_slides) -%}
                                                <button
                                                    class="slider-counter__link slider-counter__link--{{ pagination_style }} link"
                                                    aria-label="{{ 'sections.slideshow.load_slide' | t }} {{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}"
                                                    aria-controls="Slider-{{ block_id }}"
                                                >
                                                    {%- if pagination_style == 'numbers' -%}
                                                        {{ forloop.index -}}
                                                    {%- else -%}
                                                        <span class="dot"></span>
                                                    {%- endif -%}
                                                </button>
                                            {%- endfor -%}
                                        </div>
                                    {%- endif -%}
                                </div>
                                <button
                                    type="button"
                                    class="slider-button slider-button--next"
                                    name="next"
                                    aria-label="{{ 'general.slider.next_slide' | t }}"
                                >
                                    <span class="svg-wrapper">
                                        {{- 'icon-caret.svg' | inline_asset_content -}}
                                    </span>
                                </button>
                            </div>
                        {%- endif -%}
                    </slideshow-component>
                {%- if block.settings.make_collapsible_row -%}
                    </details>
                {%- endif -%}
            </div>
        </aside>
    {%- endif -%}
    {{ 'component-card.css' | asset_url | stylesheet_tag }}
    {{ 'component-complementary-products.css' | asset_url | stylesheet_tag }}
    {%- if block.settings.enable_quick_add -%}
        {{ 'quick-add.css' | asset_url | stylesheet_tag }}
        <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
</product-recommendations>